Working on C - More functions, more nested loops